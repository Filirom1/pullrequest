<!doctype html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>.::PullRequest.org::. XWiki au banc de test</title>
  <meta name="description" content="">
  <meta name="author" content="PullRequest team">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="/public/css/style.css">
  <link rel="stylesheet" href="/public/css/syntax.css">

  <script src="/public/js/libs/modernizr.custom.47336.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="/public/js/libs/jquery-1.6.2.min.js"><\/script>')</script>
</head>

<body>

  <div id="container">
    <header>
      <h1><a href="/" title="Page d'accueil"><img src="/public/img/pullrequest-logo.png" alt="PullRequest"/></a></h1>
      <a href="http://github.com/pullrequest"><img style="position: absolute; top: 0; right: 0; border: 0; z-index: 1;" src="https://a248.e.akamai.net/assets.github.com/img/abad93f42020b733148435e2cd92ce15c542d320/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub"></a>
    </header>

    <div id="main" role="main">
      <section id="content">
        
<article>
  <header>
    <h1><a href="/2011/12/14/xwiki-au-banc-de-test.html">XWiki au banc de test</a></h1>
    <p>
      <time datetime="2011-12-14" pubdate="pubdate">14 Dec 2011</time>
      <span class="author"><a href="/authors.html#feugy">Damien Feugas</a></span>
      <span class="comments"><a href="#disqus_thread" title="Voir les commentaires">Commentaires</a></span>
    </p>
  </header>
  <p>Il existe pléthore de produits pour faire un Wiki, tous plus complets les uns que les autres. Alors en quoi XWiki se démarque-t-il ?</p>

<blockquote>
<p>XWiki, c&#8217;est bien plus qu&#8217;un wiki. (~~vous voila convaincus, non ?)</p>
</blockquote>

<p>C&#8217;est en effet ce qui est crânement annoncé sur le site <a href='http://www.xwiki.org/xwiki/bin/view/Main/WebHome'>xwiki.org</a> sous l&#8217;appellation <a href='http://platform.xwiki.org/xwiki/bin/view/Main/SecondGenerationWiki'>&#8220;Wiki de seconde génération&#8221;</a>. Alors, qu&#8217;il y a t&#8217;il derrière ce discours commercial ? La promesse d&#8217;un véritable couteau-suisse du Web ? Ou un n-ième et décevant CMS ?</p>

<h2 id='cas_dtude'>Cas d&#8217;étude</h2>

<p>Pour les besoin d&#8217;une démonstration, j&#8217;ai du mettre en place un portail Web minimaliste incluant les fonctionnalités suivantes :</p>

<ul>
<li>une page d&#8217;accueil</li>

<li>un espace de partage de données publiques (nous allons y revenir)</li>

<li>un blog sans workflow de validation (brouillon &gt; publié)</li>

<li>un forum simpliste (pas de messages privé)</li>
</ul>

<p>Le tout en 2 semaines, mise en prod inclue.</p>

<p>L&#8217;occasion révée de tester XWiki, régulièrement promu par Vincent Massol dans son podcast <a href='http://lescastcodeurs.com/'>les cast codeurs</a>, et qui propose 3 des 2 fonctionnalités (le forum est un &#8220;plugin&#8221; nommé <a href='http://extensions.xwiki.org/xwiki/bin/view/Extension/Bulletin+Board+Application'>Bulletin board</a>)</p>

<p>XWiki est écrit en Java, et utilise Spring, Hibernate/JPA, Struts, et Velocity. Il est personnalisable avec Groovy, Python, Ruby ou encore Php.</p>

<h2 id='quest_ce_quun_wiki_2me_gnration_'>Qu&#8217;est ce qu&#8217;un Wiki 2ème génération ?</h2>

<p>Alors si j&#8217;ai bien tout compris (à vous de vérifier donc :)), le Wiki de 2ème génération est un <a href='http://fr.wikipedia.org/wiki/Syst%C3%A8me_de_gestion_de_contenu'>CMS</a>.</p>

<p>XWiki (en version 3.2) propose effet tout ce qui caractérise un CMS :</p>

<ul>
<li>un portail Web qui présente du contenu éditorial, produit par plusieurs utilisateurs</li>

<li>une séparation entre les données (contenues dans les Classes et les Objets) et leur présentation (utilisation de Velocity comme moteur de templating, et de CSS)</li>

<li>une structuration du contenu : hiérarchisation, organisation en espaces plus ou moins spécialisés (espace forum, espace blog&#8230;)</li>

<li>une véritable gestion des comptes utilisateurs et de leurs permissions sur l&#8217;ensemble des objets</li>

<li>un versionning du contenu</li>
</ul>

<p>En revanche, pas de workflow de publication, bien qu&#8217;il soit tout a fait possible d&#8217;en créer un.</p>

<p>Car ce qui différentie XWiki des autres produits de Wiki et CMS, c&#8217;est son extrème flexibilité. Du point de vue des utilisateurs privilégiés (le webmaster), XWiki n&#8217;est pas particulièrement facile à prendre en main. Il est en revanche <a href='http://enterprise.xwiki.org/xwiki/bin/view/UserGuide/WebHome'>très bien documenté</a> Pour les développeurs (créateur de plugins et composants) c&#8217;est l&#8217;inverse : mal documenté, et extèmement puissant.</p>

<h2 id='le_modle_de_donne_xwiki'>Le modèle de donnée XWiki</h2>

<p>Dans XWiki, tout est &#8220;document&#8221;. Héritage naturel du Wiki. Un document dispose à minima d&#8217;un nom unique (utilisé comme url), et d&#8217;un certain nombre de propriétés (clé-valeur typée String, nombre, date&#8230;). Ces propriétés sont définis dans une <code>Classe</code>, et les documents sont donc des <code>Objets</code>, instances de ces classes.</p>

<p>En gros, si je veux définir un billet de blog, je crée une classe Blog avec 3 champs (auteur, contenu, date de publication), et pour chaque billet le système crée un <code>Objet</code> ayant son url propre (<code>/xwiki/bin/view/Blog/Mon+nom+de+billet</code>).</p>

<p>Sur chaque document, XWiki propose les actions suivantes :</p>

<ul>
<li><code>edit</code>: création/mise à jour du document</li>

<li><code>view</code>: visualisation</li>

<li><code>delete</code>: suppression</li>
</ul>

<p>Au niveau rendu, il est possible d&#8217;attacher à la classe un &#8220;Class Template&#8221; : c&#8217;est le formulaire qui permet de remplir les propriétés d&#8217;un document lors de l&#8217;action <code>edit</code>. On peux aussi attacher une &#8220;Class Sheet&#8221; : template Velocity pour le rendu (action <code>view</code>) des <code>Objets</code>.</p>

<h2 id='premier_pas_en_temps_que_dveloppeur'>Premier pas en temps que développeur</h2>

<p>Très facile à installer (un war à déposer dans un conteneur Servlet), XWiki propose au développeur des fonctionnalités d&#8217;import/export, et de personnalisation en ligne.</p>

<p>Ainsi, avec les droits suffisants, et directement dans l&#8217;application, on crée et modifie <code>Classes</code> et <code>Objets</code>. Le moteur de template <a href='http://velocity.apache.org/'>Velocity</a> est très facile à prendre en main, et j&#8217;ai choisis Groovy pour la &#8220;logique applicative&#8221; à l&#8217;intérieur des pages. <a href='http://groovy.codehaus.org/'>Groovy</a> apporte toute la puissance d&#8217;un language dynamique à la plateforme Java, tirant partie des librairies existantes.</p>

<p>Tout ce passe donc à chaud, sans redémarrage. Très pratique. Par contre, on édite du code dans un textarea : aucune fonctionnalité d&#8217;IDE. Il existe cependant un plugin Eclipse pour combler ce manque.</p>

<p>Coté versionning, chaque sauvegarde provoque une nouvelle version de l&#8217;<code>Object</code>, la <code>Classe</code>, le <code>Class Template</code> ou la <code>Class Sheet</code>. Donc il est possible de revenir en arrière lorsqu&#8217;on a cassé quelque chose.</p>

<p>La fonction d&#8217;export permet de faire un zip avec les modifications et configurations qu&#8217;on a apporté à son instance. Et naturellement, la fonction d&#8217;import permet de &#8220;déployer&#8221; son zip sur une autre instance.</p>

<h2 id='le_dveloppement_spcifique'>Le développement spécifique</h2>

<p>XWiki promet une grande facilité d&#8217;extension, permettant au développeur d&#8217;enrichir les fonctionnalités de base pour ajouter un fonctionnel spécifique.</p>

<p>Dans mon cas, je devais proposer à l&#8217;intérieur du portail les fonctionnalités de collecte et partage de données publiques. Le service sous-jacent est Smart Data, accessible via une API Http. Pour résumer :</p>

<ul>
<li>Une page pour uploader un fichier de données, et donner le nom et la description de la source de données</li>

<li>Une page pour afficher et réaliser une recherche sur les sources de données existantes</li>

<li>Une page pour visualiser le contenu d&#8217;une source de données (et télécharger le fichier original)</li>

<li>Une page pour supprimer les sources de données</li>
</ul>

<p>Tout cela est réalisé en invoquant l&#8217;API Http du service Web de Smart Data, qui répond en Json.</p>

<p>Il était possible de calquer le cycle de vie d&#8217;une DataSource sur une <code>Classe</code> XWiki, et de personnaliser les actions <code>edit</code> <code>view</code> et <code>delete</code>. Toute la logique de médiation aurait été embarquée dans les pages.</p>

<p>J&#8217;ai préféré développer un &#8220;plugin&#8221; XWiki : un jar pour enrichir le fonctionnel, et encapsuler la logique de médiation. Les pages peuvent invoquer ensuite ces fonctionnalités sous la forme de &#8220;macro&#8221;. On obtient un meilleur découpage/découplage de la logique propre à Smart Data, et une meilleur testabilité (jar = projet maven = tests automatisés).</p>

<p>Ex: l&#8217;Object XWiki ViewDataSource (template Velocity)</p>
<div class='highlight'><pre><code class='html'>## Appel au service de médiation : invoque la méthode get() pour récupérer le datasource sur Smart Data.
#set($dataSource = $services.distantDataSourceService.get($request.getParameter(&#39;id&#39;)))

<span class='nt'>&lt;div</span> <span class='na'>class=</span><span class='s'>&quot;sd-datasource&quot;</span><span class='nt'>&gt;</span>
  <span class='nt'>&lt;div</span> <span class='na'>class=</span><span class='s'>&quot;sd-title&quot;</span><span class='nt'>&gt;</span>
    ## Utilisation de l&#39;objet renvoyé :
    <span class='nt'>&lt;span</span> <span class='na'>class=</span><span class='s'>&quot;sd-title&quot;</span><span class='nt'>&gt;</span>${dataSource.name}<span class='nt'>&lt;/span&gt;</span>
  <span class='nt'>&lt;/div&gt;</span>   
  <span class='nt'>&lt;div</span> <span class='na'>class=</span><span class='s'>&quot;sd-content sd-tags&quot;</span><span class='nt'>&gt;</span>
    #foreach($tag in $dataSource.tags)
      <span class='nt'>&lt;span</span> <span class='na'>class=</span><span class='s'>&quot;sd-value sd-tag&quot;</span><span class='nt'>&gt;</span>$tag<span class='nt'>&lt;/span&gt;</span>
    #end
  <span class='nt'>&lt;/div&gt;</span>
  <span class='nt'>&lt;div</span> <span class='na'>class=</span><span class='s'>&quot;sd-content sd-description&quot;</span><span class='nt'>&gt;</span>
    <span class='nt'>&lt;span</span> <span class='na'>class=</span><span class='s'>&quot;sd-label&quot;</span><span class='nt'>&gt;</span>$msg.get(&#39;sd.labels.desc&#39;)<span class='nt'>&lt;/span&gt;</span>
    <span class='nt'>&lt;span</span> <span class='na'>class=</span><span class='s'>&quot;sd-value&quot;</span><span class='nt'>&gt;</span>$!{dataSource.desc}<span class='nt'>&lt;/span&gt;</span>
  <span class='nt'>&lt;/div&gt;</span>
<span class='nt'>&lt;/div&gt;</span>
</code></pre>
</div>
<p>Ex: l&#8217;interface DataSourceService (Groovy)</p>
<div class='highlight'><pre><code class='java'><span class='kn'>import</span> <span class='nn'>org.xwiki.component.annotation.ComponentRole</span><span class='o'>;</span>

<span class='nd'>@ComponentRole</span>
<span class='kd'>interface</span> <span class='nc'>DataSourceService</span> <span class='o'>{</span>
	<span class='n'>def</span> <span class='nf'>get</span><span class='o'>(</span><span class='n'>id</span><span class='o'>)</span>
<span class='o'>}</span>
</code></pre>
</div>
<p>Ex: l&#8217;implémentation DistantDataSourceService (Groovy)</p>
<div class='highlight'><pre><code class='java'><span class='kn'>import</span> <span class='nn'>javax.inject.Named</span>
<span class='kn'>import</span> <span class='nn'>javax.inject.Singleton</span>
<span class='kn'>import</span> <span class='nn'>org.xwiki.component.annotation.Component</span>
<span class='kn'>import</span> <span class='nn'>org.xwiki.component.phase.Initializable</span>

<span class='nd'>@Singleton</span>
<span class='nd'>@Component</span>
<span class='nd'>@Named</span><span class='o'>(</span><span class='err'>&#39;</span><span class='n'>distantDataSourceService</span><span class='err'>&#39;</span><span class='o'>)</span>
<span class='kd'>class</span> <span class='nc'>DistantDataSourceService</span> <span class='kd'>implements</span> <span class='n'>DataSourceService</span><span class='o'>,</span> <span class='n'>ScriptService</span> <span class='o'>{</span>

    <span class='n'>def</span> <span class='nf'>get</span><span class='o'>(</span><span class='n'>def</span> <span class='n'>id</span><span class='o'>)</span> <span class='o'>{</span>
		<span class='n'>def</span> <span class='n'>retrieved</span> <span class='o'>=</span> <span class='kc'>null</span>
		<span class='c1'>// Retrieve the DataSource</span>
		<span class='n'>http</span><span class='o'>.</span><span class='na'>request</span><span class='o'>(</span><span class='n'>GET</span><span class='o'>,</span> <span class='n'>JSON</span><span class='o'>)</span> <span class='o'>{</span> <span class='n'>req</span> <span class='o'>-&gt;</span>
			<span class='n'>uri</span><span class='o'>.</span><span class='na'>path</span> <span class='o'>=</span> <span class='s'>&quot;api/datasources/$id&quot;</span>
			<span class='n'>response</span><span class='o'>.</span><span class='na'>success</span> <span class='o'>=</span> <span class='o'>{</span> <span class='n'>resp</span><span class='o'>,</span> <span class='n'>json</span> <span class='o'>-&gt;</span>
				<span class='n'>retrieved</span> <span class='o'>=</span> <span class='n'>json</span>
			<span class='o'>}</span>
			<span class='n'>response</span><span class='o'>.</span><span class='err'>&#39;</span><span class='mi'>500</span><span class='err'>&#39;</span> <span class='o'>=</span> <span class='o'>{</span>
				<span class='n'>retrieved</span> <span class='o'>=</span> <span class='kc'>null</span>
			<span class='o'>}</span>
			<span class='n'>response</span><span class='o'>.</span><span class='na'>failure</span> <span class='o'>=</span> <span class='o'>{</span> <span class='n'>resp</span><span class='o'>,</span> <span class='n'>json</span> <span class='o'>-&gt;</span>
				<span class='k'>throw</span> <span class='k'>new</span> <span class='nf'>Exception</span><span class='o'>(</span><span class='s'>&quot;Unable to retrieved DataSource (id $id) ${json.errors}&quot;</span><span class='o'>);</span>
			<span class='o'>}</span>
		<span class='o'>}</span>
		<span class='k'>return</span> <span class='n'>retrieved</span><span class='o'>;</span>
	<span class='o'>}</span>
</code></pre>
</div>
<p>Le système est assez simple : le composant déclare un certain nombre de services (avec les annotations de la JSR-330), ainsi que les implémentations correspondantes. Ces services sont utilisables directement depuis les Object XWiki (injection de dépendances Spring).</p>

<h2 id='conclusion__bien_ou_quoi_'>Conclusion : bien ou quoi ?</h2>

<p>XWiki se veut être un outil très flexible et très puissant, une plateforme pouvant supporter le développement de n&#8217;importe quel portail Web, quelque soit ses fonctionnalités. C&#8217;est pour le moins ambitieux.</p>

<p>Après avoir travaillé deux semaines avec, je suis assez tenté de dire que le pari est réussi.</p>

<p>Pour un développeur, la courbe d&#8217;apprentissage est minimale lorsqu&#8217;on connait Spring/Hibernate. Le modèle de donnée est simple. Velocity et Groovy sont des outils puissants et faciles à prendre en main. Pour moi, l&#8217;aggrégation de ces technologies est naturelle et à propos.</p>

<p>Maintenant, si j&#8217;ai pu atteindre mon objectif, ce ne fut pas sans grincements de dents. Et c&#8217;est principalement dû à la flexibilité de l&#8217;outil : il y a toujours 2 ou 3 manières de réaliser la même fonctionnalité. Parfois, on s&#8217;y perd un peu.</p>

<p>La documentation développeur est un gros point faible à mon sens. Enfin, les performances ne sont vraiment pas au niveau. Le temps de chargement d&#8217;une page est rédhibitoire pour un site à très fort traffic.</p>

<p>En conclusion, je suis assez conquis par XWiki, mais pas dans une optique &#8220;grosse production de gros site à gros traffic&#8221;. Etre productif en solo est facile, mais je ne suis pas aussi confiant dans le cadre d&#8217;une équipe d&#8217;une dizaine de personnes.</p>

<p>Si je peux donc émettre un conseil : essayez le, et n&#8217;hésitez pas à commenter pour donner votre avis !</p>

<p>Enfin, si vous voulez voir ce que cela donne en vrai, jetez un oeil à ce screencast :</p>
<iframe allowfullscreen='allowfullscreen' frameborder='0' height='360' src='http://www.youtube.com/embed/NuHihBI04jU?rel=0&amp;hd=1' width='640' />
  <footer>
    <section class="tags">
      <span>Tags :</span>
<ul>
  
    <li>
        <a href="tags.html#xwiki" title="Voir les posts ayant le tag xwiki">xwiki</a>
    </li>
  
    <li>
        <a href="tags.html#groovy" title="Voir les posts ayant le tag groovy">groovy</a>
    </li>
  
    <li>
        <a href="tags.html#velocity" title="Voir les posts ayant le tag velocity">velocity</a>
    </li>
  
    <li>
        <a href="tags.html#wiki" title="Voir les posts ayant le tag wiki">wiki</a>
    </li>
  
    <li>
        <a href="tags.html#CMS" title="Voir les posts ayant le tag CMS">CMS</a>
    </li>
  
    <li>
        <a href="tags.html#smartdata" title="Voir les posts ayant le tag smartdata">smartdata</a>
    </li>
  
</ul>

    </section>
    <section id="disqus_thread" class="comments">
      <script type="text/javascript">
  var disqus_shortname = 'pullrequest';
  var disqus_identifier = '/2011/12/14/xwiki-au-banc-de-test';
  $.getScript("http://pullrequest.disqus.com/embed.js");
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus</a>.</noscript>

    </section>
  </footer>
</article>

      </section><!--

   --><aside>
        <section id="about">
          <h1>A propos</h1>
          <p>PullRequest est un blog de développeurs ouvert à toute contribution appropriée.</p>
        </section>
        <section id="follow">
          <h1>Suivez nous!</h1>
          <ul>
            <li>
              <a href="http://twitter.com/pullrequest" class="twitter-follow-button" data-show-count="false" data-lang="fr">Follow @pullrequest</a>
              <script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
            </li>
            <li class="feed">
              <a rel="alternate" type="application/rss+xml" href="http://feeds.feedburner.com/pullrequest/blog-posts">abonnement RSS</a>
            </li>
          </ul>
        </section>
        <section id="contribute">
          <h1>Participer</h1>
          <p>
            Les articles sont écrits en <a href="http://daringfireball.net/projects/markdown/syntax">MarkDown</a> et stockés dans un repository Git sur <a href="http://github.com/pullrequest/pullrequest.github.com">Github</a>.
            N'hésitez pas à <strong>forker</strong> puis à faire une <strong><a href="https://github.com/pullrequest/pullrequest.github.com/pull/new/master">Pull Request</a></strong> ;)
          </p>
        </section>
        <section id="licensing">
          <h1>Licence</h1>
          <p>
            Les articles sont mis à disposition selon les termes de la <a rel="license" href="http://creativecommons.org/licenses/by/2.0/fr/">Licence Creative Commons Paternité 2.0 France</a>.
            <a rel="license" href="http://creativecommons.org/licenses/by/2.0/fr/">
              <br><img alt="Contrat Creative Commons" style="border-width:0" src="http://i.creativecommons.org/l/by/2.0/fr/88x31.png" />
            </a>
          </p>
        </section>
        <section id="opensource">
          <h1>OpenSource</h1>
          <p>Les auteurs de PullRequest sont à l'origine, ou contributeurs, entre autres, de ces projets:</p>
          <ul>
            <li><a href="http://openscales.org">OpenScales</a></li>
            <li><a href="http://resthub.org">RestHub</a></li>
            <li><a href="https://github.com/loicfrering/LosoBundle">LosoBundle</a></li>
            <li><a href="https://github.com/loicfrering/losolib">LoSoLib</a></li>
            <li><a href="https://bitbucket.org/feugy/myth">Myth</a></li>
          </ul>
        </section>
      </aside>

    </div>

    <footer>
      <small id="legal">© 2011 pullrequest.org</small>
      <small id="poweredby">Propulsé par <a href="http://jekyllrb.com">Jekyll</a></small>
    </footer>
  </div>

  <script defer src="/public/js/tags.js"></script>
  <script defer src="/public/js/authors.js"></script>

  <script>
    var _gaq=[["_setAccount","UA-22833612-1"],["_trackPageview"]];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.async=1;
    g.src=("https:"==location.protocol?"//ssl":"//www")+".google-analytics.com/ga.js";
    s.parentNode.insertBefore(g,s)}(document,"script"));
  </script>

  <!--[if lt IE 7 ]>
  <script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
  <script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script>
  <![endif]-->

</body>
</html>
